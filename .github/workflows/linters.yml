name: Linters
on: 
   workflow_call:
    inputs:
      compare-branch:
        required: true
        type: string      
jobs:
  ruff:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          path: repo
      - uses: actions/checkout@v4
        with:
          repository: ISISComputingGroup/reusable-workflows
          path: config
      - uses: chartboost/ruff-action@491342200cdd1cf4d5132a30ddc546b3b5bc531b
        with: 
          changed-files: 'true'
          src: repo
          args: 'check repo --config config/ruff.toml'
      - uses: chartboost/ruff-action@491342200cdd1cf4d5132a30ddc546b3b5bc531b
        with: 
          changed-files: 'true'
          src: repo
          args: 'format --check --config config/ruff.toml'
  pyright:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-python@v5
        with:
           python-version: '3.10'
      - run: pip install unittest-xml-reporting
      - uses: actions/checkout@v4
        with:
           fetch-depth: 0
      - name: install pyright
        run: pip install pyright
      - name: install diff_cover
        run: pip install diff_cover
      - name: install pyright_plugin
        run: pip install git+https://github.com/DiamondLightSource/pyright_diff_quality_plugin.git
      - name: Run Pyright on changes
        run: diff-quality --violations=pyright --compare-branch ${{ inputs.compare-branch }}
